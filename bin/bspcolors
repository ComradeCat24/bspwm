#!/usr/bin/env bash

## Copyright (C) 2020-2022 Aditya Shakya <adi1090x@gmail.com>
## Everyone is permitted to copy and distribute copies of this file under GNU-GPL3

## A script to get colours from the theme file & deploy it to polybar, alacritty, rofi & dunst.

DIR="$HOME/.config/bspwm"

## Current theme ---------------------------------------------#
source "$DIR"/themes/current.bash

## Get colors
getcolors () {
	WALLPAPER="$wallpaper"
	FOREGROUND="$foreground"
	BACKGROUND="$background"
	CURSOR="$cursor"
	BLACK="$color0"
	RED="$color1"
	GREEN="$color2"
	YELLOW="$color3"
	BLUE="$color4"
	MAGENTA="$color5"
	CYAN="$color6"
	WHITE="$color7"
	ALTBLACK="$color8"
	ALTRED="$color9"
	ALTGREEN="$color10"
	ALTYELLOW="$color11"
	ALTBLUE="$color12"
	ALTMAGENTA="$color13"
	ALTCYAN="$color14"
	ALTWHITE="$color15"
}

## Write polybar colors file with current theme colors
bspbar () {
	cat > "$DIR"/polybar/colors.ini <<- EOF	
	[color]

	FOREGROUND = ${FOREGROUND}
	BACKGROUND = ${BACKGROUND}
	BLACK = ${BLACK}
	RED = ${RED}
	GREEN = ${GREEN}
	YELLOW = ${YELLOW}
	BLUE = ${BLUE}
	MAGENTA = ${MAGENTA}
	CYAN = ${CYAN}
	WHITE = ${WHITE}
	ALTBLACK = ${ALTBLACK}
	ALTRED = ${ALTRED}
	ALTGREEN = ${ALTGREEN}
	ALTYELLOW = ${ALTYELLOW}
	ALTBLUE = ${ALTBLUE}
	ALTMAGENTA = ${ALTMAGENTA}
	ALTCYAN = ${ALTCYAN}
	ALTWHITE = ${ALTWHITE}
	EOF
}

## Write alacritty colors.yml file with current theme colors
bspterm () {
	cat > "$DIR"/alacritty/colors.yml <<- _EOF_
		## Colors configuration
		colors:
		  # Default colors
		  primary:
		    background: '${BACKGROUND}'
		    foreground: '${FOREGROUND}'

		  # Normal colors
		  normal:
		    black:   '${BLACK}'
		    red:     '${RED}'
		    green:   '${GREEN}'
		    yellow:  '${YELLOW}'
		    blue:    '${BLUE}'
		    magenta: '${MAGENTA}'
		    cyan:    '${CYAN}'
		    white:   '${WHITE}'

		  # Bright colors
		  bright:
		    black:   '${ALTBLACK}'
		    red:     '${ALTRED}'
		    green:   '${ALTGREEN}'
		    yellow:  '${ALTYELLOW}'
		    blue:    '${ALTBLUE}'
		    magenta: '${ALTMAGENTA}'
		    cyan:    '${ALTCYAN}'
		    white:   '${ALTWHITE}'
	_EOF_
}

## Write rofi colors.rasi file with current theme colors
bsprofi () {
	cat > "$DIR"/rofi/themes/colors.rasi <<- EOF	
	* {
	    background:			${BACKGROUND};
	    foreground:			${FOREGROUND};
	    selected:			${BLUE};
	    highlight:			${YELLOW};
	    urgent:				${RED};
	    on:					${GREEN};
	    off:				${RED};
	}
	EOF
}

## Write dunstrc file with current theme colors
bspdunst () {
	sed -i '/urgency_low/Q' "$DIR"/dunstrc
	cat >> "$DIR"/dunstrc <<- _EOF_
		[urgency_low]
		timeout = 2
		background = "${BACKGROUND}00"
		foreground = "${BLUE}"
		frame_color = "${BLUE}"

		[urgency_normal]
		timeout = 5 
		background = "${BACKGROUND}00"
		foreground = "${BLUE}"
		frame_color = "${BLUE}"

		[urgency_critical]
		timeout = 0
		background = "${BACKGROUND}00"
		foreground = "${RED}"
		frame_color = "${RED}"
	_EOF_
}

bspsddm () {
	sed -i '/wal_generated/Q' /usr/share/sddm/themes/bspsddm/theme.conf
	cat >> /usr/share/sddm/themes/bspsddm/theme.conf <<- _EOF_
		# [wal_generated]
		Background = "${WALLPAPER}"
		MainColor=${ALTGREEN}
		AccentColor=${ALTBLUE}
		BackgroundColor=${BACKGROUND}
	_EOF_
}

bspbetterlockscreen () {
	cat > "$DIR"/betterlockscreen/betterlockscreenrc <<- _EOF_
		# default options
		display_on=0
		span_image=false
		lock_timeout=300
		fx_list=(dim blur dimblur pixel dimpixel color)
		dim_level=40
		blur_level=1
		pixel_scale=10,1000
		solid_color=333333
		wallpaper_cmd="feh --bg-fill $wallpaper"
		quiet=false
		# i3lockcolor_bin="i3lock-color" # Manually set command for i3lock-color

		# default theme
		loginbox=00000066
		loginshadow=00000000
		# locktext="Type password to unlock..."
		locktext="\$(date "\+%a \%d \%b")"
		font="sans-serif"
		ringcolor=ffffffff
		insidecolor=00000000
		separatorcolor=00000000
		ringvercolor=ffffffff
		insidevercolor=00000000
		ringwrongcolor=ffffffff
		insidewrongcolor=d23c3dff
		timecolor=ffffffff
		time_format="%H:%M:%S"
		greetercolor=ffffffff
		layoutcolor=ffffffff
		keyhlcolor=d23c3dff
		bshlcolor=d23c3dff
		verifcolor=ffffffff
		wrongcolor=d23c3dff
		modifcolor=d23c3dff
		bgcolor=000000ff
	_EOF_
}


## Execute functions and run main 
main () {
	getcolors
	bspbar
	bspterm
	bsprofi
	bspdunst
	bspsddm
	# bspbetterlockscreen
}

main
